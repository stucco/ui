<meta charset="US-ASCII">
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<polymer-element name="rexster-detail-query-component" attributes="queryHost queryPort queryParams vertex edgeTable edgeTypeMap">
    <template>
    	<core-ajax id="vertexReq" url="http://{{queryHost}}:{{queryPort}}/graphs/graph/vertices/{{queryParams}}" handleAs="json" contentType="application/json" headers='{"Accept": "application/json"}' on-core-response="{{getVertices}}" on-core-error="{{handleError}}"></core-ajax>
      	<core-ajax id="edgeReq" url="http://{{queryHost}}:{{queryPort}}/graphs/graph/vertices/{{queryParams}}/bothE" handleAs="json" contentType="application/json" headers='{"Accept": "application/json"}' on-core-response="{{handleEdgeResponse}}" on-core-error="{{handleError}}"></core-ajax>

      <paper-toast id="errorMsg" text="Server error."></paper-toast>
    </template>
    <script>
        Polymer('rexster-detail-query-component', {
          queryHost : "localhost",
          queryPort : 8182,
		  queryParams : "",
          vertex : [],
		  edgeTable : [],
          queryParamsChanged : function() {
          	  if (this.queryParams != "") {
              	this.$.vertexReq.go();
              }
          },
          getVertices : function() {
              this.vertex = this.$.vertexReq.response.results;
              this.$.edgeReq.go();
          },
          handleEdgeResponse : function() {
          	  this.edgeTable = this.$.edgeReq.response.results;
          	  console.log(this.edgeTable);
          	  this.queryParams = "";
          },
          handleError : function() {
            this.$.errorMsg.show();
          }
        });
    </script>
</polymer-element>
