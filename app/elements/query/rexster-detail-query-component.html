<meta charset="US-ASCII">
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<polymer-element name="rexster-detail-query-component" attributes="queryHost queryPort queryParams vertex edges edgeTable edgeTypeMap">
    <template>
    	<core-ajax id="vertexReq" url="http://{{queryHost}}:{{queryPort}}/graphs/graph/vertices/{{queryParams}}" handleAs="json" contentType="application/json" headers='{"Accept": "application/json"}' on-core-response="{{getVertices}}" on-core-error="{{handleError}}"></core-ajax>
      <core-ajax id="adjacentReq" url="http://{{queryHost}}:{{queryPort}}/graphs/graph/vertices/{{queryParams}}/bothE" handleAs="json" contentType="application/json" headers='{"Accept": "application/json"}' on-core-response="{{handleResponse}}" on-core-error="{{handleError}}"></core-ajax>

      <paper-toast id="errorMsg" text="Server error."></paper-toast>
    </template>
    <script>
        Polymer('rexster-detail-query-component', {
          queryHost : "localhost",
          queryPort : 8182,
		      queryParams : "",
          vertex : [],
          edges : [],
		      edgeTable : {},
          edgeTypeMap : {},
          queryParamsChanged : function() {
          	  if (this.queryParams != "") {
              	this.$.vertexReq.go();
              }
          },
          getVertices : function() {
              this.vertex = this.$.vertexReq.response.results;
              this.$.adjacentReq.go();
          },
          handleResponse : function() {
          		this.edges = this.$.adjacentReq.response.results;
          		this.queryParams = "";
              // var adjacents = this.$.adjacentReq.response.results;
              // // console.log(adjacents);

              // for (var i=0; i<adjacents.length; i++) {
              //   var key = JSON.stringify(adjacents[i]["vertexType"]) + "_" + JSON.stringify(this.vertex["vertexType"]);
              //   var altKey = JSON.stringify(this.vertex["vertexType"]) + "_" + JSON.stringify(adjacents[i]["vertexType"]);
              //   if (this.edgeTypeMap[key]) {
              //     console.log("key found = " + key + " --> " + this.edgeTypeMap[key]);
              //   }
              //   else if (this.edgeTypeMap[altKey]) {
              //     console.log("alt key found = " + altKey + " --> " + this.edgeTypeMap[altKey]);
              //   }
              // }
              // this.queryParams = "";
          },
          handleError : function() {
            this.$.errorMsg.show();
          }
        });
    </script>
</polymer-element>
